// B U R K E   L A B   G E N O M I C   D A T A   P I P E L I N E
// =============================================================
// This is the config file. Please set the parameters to match your project specifics.

// Leave one organism selected by commenting out (appending // to the start of the line) of the other organism
params.organism             = 'Saccharomyces_cerevisiae'
// params.organism         = 'Drosophila_melanogaster'

// Note that directories should end with a '/' !!!

params.lab_directory	    = '/nfs6/TMP/Burke_Lab/'
params.project_folder       = params.lab_directory + 'EEA/'
params.samples_directory    = params.project_folder + 'raw/'
 
params.pipeline_run_dir     = params.project_folder + 'pipeline_runs/2025_09_17_round04/'
params.metadata             = params.pipeline_run_dir + 'metadata_nextflow.csv'
params.results_directory    = params.pipeline_run_dir + 'results/'








// Maintenance parameters -- warning: risk of breaking things!
// You should not have to edit these parameters often
// The parameters from now on should be adjusted based on your infrastructure
// These values are the ones used by the Burke_Lab when working at OSU's Wildwood HPC

params.scratch_directory    = '/scratch/workingdir/' 
params.debug                = false
params.max_cpus             = 248
params.max_memory           = '1.9T'

if (params.organism == 'Saccharomyces_cerevisiae') {

  params.snpeff_organism  = 'Saccharomyces_cerevisiae'
  params.reference_genome = params.lab_directory + 'shared_data/reference_genomes/S_cerevisiae/S288C_reference_sequence_R64-1-1_20110203.fasta'
  params.bqsr_vcf         = params.lab_directory + 'shared_data/reference_genomes/S_cerevisiae/1011Matrix_renamed.gvcf.gz'

} else if (params.organism == 'Drosophila_melanogaster') { 

  params.snpeff_organism  = 'Drosophila_melanogaster'
  params.reference_genome = params.lab_directory + 'shared_data/reference_genomes/D_melanogaster/dmel-all-chromosome-r6.51.fasta'
  params.bqsr_vcf         = params.lab_directory + 'shared_data/reference_genomes/D_melanogaster/DGRP2.source_NCSU.dm6.final.vcf'
  
}

process {
    executor            = 'slurm'
    queue               = 'burke_lab'
    scratch             = '/scratch/workingdir'

    // For I/O heavy, mostly single-threaded tasks (e.g., FastQC, MergeSamFiles)
    withLabel: io_intensive {
      cpus              = 4
      memory            = '64G'
    }

    // For multi-threaded alignment and variant calling per sample (e.g., BwaMem, HaplotypeCaller)
    withLabel: parallel_per_sample {
      cpus              = 31 // Adjusted for 8 concurrent jobs (248 available / 8 jobs)
      memory            = '250G'
    }

    // For memory-intensive, single-threaded GATK tasks (e.g., MarkDuplicates, SelectVariants)
    withLabel: high_mem_single {
      cpus              = 8
      memory            = '500G'
    }

    // For the final, cohort-wide joint-calling steps (e.g., GenomicsDBImport, GenotypeGVCFs)
    withLabel: joint_calling {
      cpus              = 64
      memory            = '1.8T'
    }
}

executor.queueSize    = 9

report {
  enabled = true
  file = "${params.results_directory}/reports/report.html"
  overwrite = true
}

trace {
  enabled = true
  file = "${params.results_directory}/reports/trace.txt"
  overwrite = true
}

timeline {
  enabled = true
  file = "${params.results_directory}/reports/timeline.html"
  overwrite = true
}

dag {
  enabled = true
  file = "${params.results_directory}/reports/dag.html"
  overwrite = true
}

manifest {
  author      = 'Giovanni Alberto Crestani'
  name        = 'Burke Lab Genomics Pipeline'
  description = 'Pipeline does this and that'
  mainScript  = 'main.nf'
  version     = '1.1.2'
}

